{% extends "base.html" %} 

{% load static %}

{% block title %}Ticket Details{% endblock title %} 

{% block content %}
    <div class="pagetitle">
        <h1>Dashboard</h1>
        <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url "dashboard" %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url "all-tickets" %}">Tickets</a></li>
            <li class="breadcrumb-item active">{{selected_ticket.ticket_number}}</li>
        </ol>
        </nav>
    </div>
    <!-- End Page Title -->

    <section class="section">

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <h2 class="pt-3 pe-5">Summary: {{ selected_ticket.summary }}</h2>
                                        <hr class="mt-3">
                                        <button type="button" class="btn btn-secondary btn-sm"><i class="bi bi-paperclip"></i> Upload</button>
                                        <button type="button" class="btn btn-secondary btn-sm"><i class="bi bi-pencil-square"></i> Edit</button>
                                        <button type="button" class="btn btn-secondary btn-sm"><i class="bi bi-arrow-right-circle"></i> Transfer</button>

                                        <div class="mt-5 pe-5">Issue Type: {{ selected_ticket.issue_type }}</div>
                                        <div class="mt-5 pe-5">Description: {{ selected_ticket.description }}</div>
                                    </div>

                                    <div class="col-lg-4">
            
                                        <div class="mb-2">
                                            <h5 class="card-title">Ticket Details</h5>
                                            <div class="badge rounded-pill text-bg-success">{{ selected_ticket.status }}</div>
                                            <div class="mt-3"><span class="fw-semibold">Last updated: </span><i class="bi bi-calendar"></i> {{ selected_ticket.updated_at|date:"m/d/Y g:i A" }}</div>
                                            <div class="mt-3"><span class="fw-semibold">Created on: </span><i class="bi bi-calendar"></i> {{ selected_ticket.created_at|date:"m/d/Y g:i A" }}</div>
                                            <div class="mt-3"><span class="fw-semibold">Department: </span>{{ selected_ticket.created_by.department }}</div>
        
                                        </div>
        
                                        <hr class="">
                                        
                                        <div class="mb-2">
                                            <h5 class="card-title pt-1">Assignees:</h5>
                                            {% if selected_ticket.assigned_agent.avatar %}
                                            <img src="{{ selected_ticket.assigned_agent.avatar.url }}" alt="Profile" class="rounded-circle asignee-avatar" />
                                            {{ selected_ticket.assigned_agent.get_full_name }}
                                            {% endif %}
                                        </div>
        
                                        <hr class="">
        
                                        <div class="mb-2">
                                            <h5 class="card-title pt-1">Created By:</h5>
                                            {% if selected_ticket.created_by.avatar %}
                                            <img src="{{ selected_ticket.created_by.avatar.url }}" alt="Profile" class="rounded-circle asignee-avatar" />
                                            {{ selected_ticket.created_by.get_full_name }}
                                            {% endif %}
                                        </div>
        
                                        <hr class="">
        
                                        <div class="mb-2">
                                            <h5 class="card-title pt-1">Contact Details</h5>
                                            <div><span class="fw-semibold">Email: </span>{{selected_ticket.created_by.email}}</div>
                                            <div><span class="fw-semibold">Phone: </span>{{selected_ticket.created_by.phone}}</div>
                                        </div>
                             
                                    </div>
                                </div>

                                <!-- Comment Form -->
                                <div class="row">
                                    <div class="col-lg-8">
                                        <h4 class="pt-3 pe-5">Add Notes</h4>
                                        <form class="row g-3" method="POST" novalidate>
                                            {% csrf_token %}
                                            {% for form_field in comment_form %}
                                            {{ form_field }}
                                            {{form_field.errors}}
                                            {% endfor %}
                                            <button class="btn btn-primary" type="submit">Submit</button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Comment Section -->
                                <div class="row">
                                    <div class="col-lg-8">
                                        <h4 class="mt-5">All Comments</h4>

                                        {% for comment in selected_ticket.comments.all %}
                                        <div class="card">
                                            <div class="card-comment">
                                                <div class="comment-header">
                                                    <img src="{{ comment.created_by.avatar.url }}" alt="Profile" class="rounded-circle asignee-avatar" />
                                                    {% if comment.created_by.get_full_name %}
                                                    {{ comment.created_by.get_full_name }}
                                                    {% else %}
                                                    {{ comment.created_by }}
                                                    {% endif %}
                                                    <span class="mx-1">&bullet;</span>
                                                    {{ comment.created_at }}
                                                </div>
                                                <div class="mt-3">
                                                {{ comment }}
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        

                                    </div>
                                </div>


                            </div>

                            
                        </div>
                    </div>

                </div>

    </section>

<!-- End #main -->

{% endblock content %}
