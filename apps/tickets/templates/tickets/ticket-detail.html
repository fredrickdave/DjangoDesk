{% extends "base.html" %} 

{% load static %}

{% block title %}Ticket Details{% endblock title %} 

{% block content %}
    <div class="pagetitle">
        <h1>Dashboard</h1>
        <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url "dashboard" %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url "all-tickets" %}">Tickets</a></li>
            <li class="breadcrumb-item active">{{selected_ticket.ticket_number}}</li>
        </ol>
        </nav>
    </div>
    <!-- End Page Title -->

    <section class="section">

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <h3 class="pt-3 pe-5">Summary: {{ selected_ticket.summary }}</h3>
                                        <hr class="mt-3">
                                        <button type="button" class="btn btn-primary btn-sm"><i class="bi bi-paperclip"></i> Upload</button>
                                        <button type="button" class="btn btn-primary btn-sm"><i class="bi bi-pencil-square"></i> Edit</button>
                                        <button type="button" class="btn btn-primary btn-sm"><i class="bi bi-arrow-right-circle"></i> Transfer</button>

                                        <div class="mt-4 pe-5"><span class="fw-semibold">Attachments: </span>
                                            {% if selected_ticket.attachments.all %}
                                            {% for attachment in selected_ticket.attachments.all %}
                                            
                                                <span class="badge rounded-pill bg-secondary">
                                                    <a href="{{ attachment.url }}" target="_blank" class="attachment-label">
                                                        {{ attachment.attachment_name }}
                                                    </a>

                                                    <!-- Button trigger modal -->
                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#attachment{{ attachment.id }}Modal">
                                                        <i class="bi bi-x-lg attachment-label"></i>
                                                    </a>
                                                </span> 
                                            
                                                <!-- Modal -->
                                                <div class="modal fade" id="attachment{{ attachment.id }}Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Delete {{ attachment.attachment_name }}</h1>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                        Are you sure you want to delete this attachment?
                                                        </div>
                                                        <div class="modal-footer">
                                                        <a href="#" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</a>
                                                        <a href="{% url "delete-attachment" ticket_number=selected_ticket.ticket_number pk=attachment.id %}" class="btn btn-primary">Delete</a>
                                                        </div>
                                                    </div>
                                                    </div>
                                                </div>
                                            {% endfor %}


                                            {% else %}
                                            No attachment
                                            {% endif %}
                                        </div>
                                            
                                        <div class="mt-4 pe-5"><span class="fw-semibold">Issue Type: </span>{{ selected_ticket.issue_type }}</div>
                                        <div class="mt-3 pe-5"><span class="fw-semibold">Description: </span>{{ selected_ticket.description }}</div>
                                    </div>

                                    <div class="col-lg-4">
            
                                        <div class="mb-2">
                                            <h5 class="card-title">Ticket Details</h5>
                                            <div class="badge rounded-pill text-bg-success">{{ selected_ticket.status }}</div>
                                            <div class="mt-3"><span class="fw-semibold">Last updated: </span><i class="bi bi-calendar"></i> {{ selected_ticket.updated_at|date:"m/d/Y g:i A" }}</div>
                                            <div class="mt-3"><span class="fw-semibold">Created on: </span><i class="bi bi-calendar"></i> {{ selected_ticket.created_at|date:"m/d/Y g:i A" }}</div>
                                            <div class="mt-3"><span class="fw-semibold">Department: </span>{{ selected_ticket.created_by.department }}</div>
        
                                        </div>
        
                                        <hr class="">
                                        
                                        <div class="mb-2">
                                            <h5 class="card-title pt-1">Assignees:</h5>
                                            {% if selected_ticket.assigned_agent.avatar %}
                                            <img src="{{ selected_ticket.assigned_agent.avatar.url }}" alt="Profile" class="rounded-circle asignee-avatar" />
                                            {% endif %}
                                            {{ selected_ticket.assigned_agent.get_full_name }}
                                        </div>
        
                                        <hr class="">
        
                                        <div class="mb-2">
                                            <h5 class="card-title pt-1">Created By:</h5>
                                            {% if selected_ticket.created_by.avatar %}
                                            <img src="{{ selected_ticket.created_by.avatar.url }}" alt="Profile" class="rounded-circle asignee-avatar" />
                                            {% endif %}
                                            {{ selected_ticket.created_by.get_full_name }}
                                        </div>
        
                                        <hr class="">
        
                                        <div class="mb-2">
                                            <h5 class="card-title pt-1">Contact Details</h5>
                                            <div><span class="fw-semibold">Email: </span>{{selected_ticket.created_by.email}}</div>
                                            <div><span class="fw-semibold">Phone: </span>{{selected_ticket.created_by.phone}}</div>
                                        </div>
                             
                                    </div>
                                </div>

                                {% include "tickets/includes/comment-section.html" %}


                            </div>

                            
                        </div>
                    </div>

                </div>

    </section>

<!-- End #main -->

{% endblock content %}
